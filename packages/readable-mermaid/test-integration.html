<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Srndpty - Integration Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            margin-bottom: 40px;
        }
        
        h1, h2 {
            color: #1f2937;
        }
        
        .diagram-container {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin: 20px 0;
            height: 400px;
        }
        
        .controls {
            margin: 10px 0;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        .spec-display {
            background: #f3f4f6;
            padding: 16px;
            border-radius: 6px;
            margin: 16px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .success {
            color: #059669;
            font-weight: 600;
        }
        
        .error {
            color: #dc2626;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <h1>‚ú® Srndpty - Integration Test</h1>
    <p>Testing the universal framework in vanilla JavaScript environment.</p>

    <div class="container">
        <h2>Test 1: Basic Flow Diagram</h2>
        <div class="controls">
            <button onclick="diagram1.fit()">Fit</button>
            <button onclick="diagram1.reset()">Reset</button>
            <button onclick="diagram1.zoomIn()">Zoom In</button>
            <button onclick="diagram1.zoomOut()">Zoom Out</button>
            <button onclick="diagram1.exportSVG()">Export SVG</button>
            <button onclick="diagram1.exportPNG()">Export PNG</button>
        </div>
        <div id="diagram1" class="diagram-container"></div>
        <div class="spec-display">
            <strong>Spec:</strong>
            <pre id="spec1-display"></pre>
        </div>
        <div id="result1"></div>
    </div>

    <div class="container">
        <h2>Test 2: Complex Microservices Architecture</h2>
        <div class="controls">
            <button onclick="diagram2.fit()">Fit</button>
            <button onclick="diagram2.reset()">Reset</button>
            <button onclick="diagram2.zoomIn()">Zoom In</button>
            <button onclick="diagram2.zoomOut()">Zoom Out</button>
        </div>
        <div id="diagram2" class="diagram-container"></div>
        <div class="spec-display">
            <strong>Spec:</strong>
            <pre id="spec2-display"></pre>
        </div>
        <div id="result2"></div>
    </div>

    <script type="module">
        // Import from the built distribution (when published, use: import Srndpty from 'srndpty')
        import Srndpty from './dist/index.js';
        
        // Test specs
        const basicSpec = {
            type: 'flow',
            direction: 'LR',
            nodes: [
                { id: 'start', label: 'Start Process', shape: 'stadium' },
                { id: 'process', label: 'Transform Data\n(validate & clean)' },
                { id: 'decision', label: 'Valid Data?', shape: 'diamond' },
                { id: 'save', label: 'Save to Database', shape: 'cylinder' },
                { id: 'error', label: 'Show Error Message' },
                { id: 'end', label: 'Complete', shape: 'stadium' }
            ],
            edges: [
                { from: 'start', to: 'process', label: 'begin' },
                { from: 'process', to: 'decision' },
                { from: 'decision', to: 'save', label: 'yes', style: 'thick' },
                { from: 'decision', to: 'error', label: 'no', style: 'dotted' },
                { from: 'save', to: 'end', label: 'success' },
                { from: 'error', to: 'end', label: 'handled' }
            ]
        };

        const microservicesSpec = {
            type: 'flow',
            direction: 'TB',
            nodes: [
                { id: 'user', label: 'User', shape: 'circle' },
                { id: 'gateway', label: 'API Gateway', shape: 'hexagon' },
                { id: 'auth', label: 'Auth Service' },
                { id: 'user-svc', label: 'User Service' },
                { id: 'order-svc', label: 'Order Service' },
                { id: 'payment-svc', label: 'Payment Service' },
                { id: 'db-users', label: 'Users DB', shape: 'cylinder' },
                { id: 'db-orders', label: 'Orders DB', shape: 'cylinder' },
                { id: 'queue', label: 'Message Queue', shape: 'stadium' }
            ],
            edges: [
                { from: 'user', to: 'gateway' },
                { from: 'gateway', to: 'auth', label: 'authenticate' },
                { from: 'gateway', to: 'user-svc', label: 'user ops' },
                { from: 'gateway', to: 'order-svc', label: 'orders' },
                { from: 'user-svc', to: 'db-users' },
                { from: 'order-svc', to: 'db-orders' },
                { from: 'order-svc', to: 'payment-svc', label: 'process payment' },
                { from: 'payment-svc', to: 'queue', label: 'events', style: 'dotted' }
            ],
            groups: [
                { 
                    id: 'services', 
                    label: 'Microservices', 
                    nodes: ['auth', 'user-svc', 'order-svc', 'payment-svc'] 
                },
                { 
                    id: 'storage', 
                    label: 'Data Layer', 
                    nodes: ['db-users', 'db-orders', 'queue'] 
                }
            ]
        };

        // Display specs
        document.getElementById('spec1-display').textContent = JSON.stringify(basicSpec, null, 2);
        document.getElementById('spec2-display').textContent = JSON.stringify(microservicesSpec, null, 2);

        // Global diagram instances for button controls
        window.diagram1 = null;
        window.diagram2 = null;

        // Test 1: Basic diagram
        try {
            console.log('üß™ Test 1: Creating basic diagram...');
            
            window.diagram1 = await Srndpty.render(basicSpec, {
                container: '#diagram1',
                enablePanZoom: true,
                onNodeClick: (nodeId, node) => {
                    alert(`Clicked node: ${nodeId}\nLabel: ${node.label}`);
                },
                onEdgeClick: (edge) => {
                    alert(`Clicked edge: ${edge.from} ‚Üí ${edge.to}${edge.label ? `\nLabel: ${edge.label}` : ''}`);
                }
            });
            
            document.getElementById('result1').innerHTML = '<span class="success">‚úÖ Test 1 passed - Basic diagram rendered successfully!</span>';
            console.log('‚úÖ Test 1 passed');
            
        } catch (error) {
            console.error('‚ùå Test 1 failed:', error);
            document.getElementById('result1').innerHTML = `<span class="error">‚ùå Test 1 failed: ${error.message}</span>`;
        }

        // Test 2: Complex diagram with groups
        try {
            console.log('üß™ Test 2: Creating microservices diagram...');
            
            window.diagram2 = await Srndpty.render(microservicesSpec, {
                container: '#diagram2',
                enablePanZoom: true,
                onNodeClick: (nodeId, node) => {
                    console.log('Node clicked:', nodeId, node);
                    const container = document.getElementById('result2');
                    container.innerHTML = `<span class="success">Clicked: ${node.label} (${nodeId})</span>`;
                },
                onEdgeClick: (edge) => {
                    console.log('Edge clicked:', edge);
                    const container = document.getElementById('result2');
                    container.innerHTML = `<span class="success">Clicked edge: ${edge.from} ‚Üí ${edge.to}</span>`;
                }
            });
            
            document.getElementById('result2').innerHTML = '<span class="success">‚úÖ Test 2 passed - Complex diagram with groups rendered successfully!</span>';
            console.log('‚úÖ Test 2 passed');
            
        } catch (error) {
            console.error('‚ùå Test 2 failed:', error);
            document.getElementById('result2').innerHTML = `<span class="error">‚ùå Test 2 failed: ${error.message}</span>`;
        }

        // Environment info
        console.log('üîç Environment Info:', Srndpty.getEnvironmentInfo());
        
        console.log('üéâ Integration tests completed!');
    </script>
</body>
</html>
